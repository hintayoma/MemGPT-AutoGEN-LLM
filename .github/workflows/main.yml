name: üñ•Ô∏è RDP Chain - Node A Launch

on:
  workflow_dispatch:

jobs:
  node-a:
    name: üöÄ Launch RDP Node A
    runs-on: windows-latest
    timeout-minutes: 340

    steps:
      - name: üîΩ Download RDP Node Script
        run: |
          Invoke-WebRequest 'https://gitlab.com/Shahzaib-YT/ngrok-multi-nodes/-/raw/main/rdp-node.ps1' -OutFile 'rdp.ps1'
        shell: pwsh

      - name: üß± Run Node A Script
        run: |
          powershell -ExecutionPolicy Bypass -File .\rdp.ps1
        shell: pwsh
        env:
          NGROK_AUTH_TOKEN: ${{ secrets.NGROK_AUTH_TOKEN }}
          RDP_B_URL: ${{ secrets.RDP_B_URL }}

      - name: üì¶ Upload RDP A Tunnel Info
        if: always()
        run: |
          $path = "$Env:USERPROFILE\Desktop\RDP_A_TUNNEL.txt"
          if (Test-Path $path) {
            Copy-Item $path rdp_a_url.txt
          } else {
            "No tunnel file generated." | Out-File rdp_a_url.txt
          }
        shell: pwsh

      - name: ‚òÅÔ∏è Save Tunnel Info as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: RDP-A-Tunnel
          path: rdp_a_url.txt
