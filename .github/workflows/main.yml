name: RDP Chain Node

on:
  workflow_dispatch:
    inputs:
      NGROK_AUTH_TOKEN:
        description: 'Enter your Ngrok Auth Token'
        required: true
      NODE_ID:
        description: 'Node number (e.g. 1, 2, 3...)'
        required: true

jobs:
  run-rdp-node:
    name: Node ${{ inputs.NODE_ID }} - Deploy
    runs-on: windows-latest
    timeout-minutes: 290

    steps:
      - name: ðŸ§  Set variables
        run: |
          echo "NODE_ID=${{ inputs.NODE_ID }}" >> $env:GITHUB_ENV
          echo "NGROK_AUTH_TOKEN=${{ inputs.NGROK_AUTH_TOKEN }}" >> $env:GITHUB_ENV

      - name: ðŸ“¥ Download PowerShell script
        run: |
          Invoke-WebRequest -Uri "https://gitlab.com/Shahzaib-YT/ngrok-multi-nodes/-/raw/main/rdp-node.ps1" -OutFile "rdp-node.ps1"

      - name: ðŸš€ Execute Node ${{ inputs.NODE_ID }}
        shell: pwsh
        run: |
          powershell -ExecutionPolicy Bypass -File .\rdp-node.ps1
