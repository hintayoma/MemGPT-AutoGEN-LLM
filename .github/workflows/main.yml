name: Multi RDP Chain Execution

on:
  workflow_dispatch:

jobs:
  create-nodes:
    runs-on: windows-latest
    timeout-minutes: 360
    strategy:
      fail-fast: false
      matrix:
        node_id: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

    steps:
      - name: ‚è≥ Wait for start window
        if: matrix.node_id != 1
        shell: pwsh
        run: |
          $wait = (300 * (${{ matrix.node_id }} - 1)) * 60
          Write-Host "‚è± Waiting $wait seconds before starting Node ${{ matrix.node_id }}..."
          Start-Sleep -Seconds $wait

      - name: üì• Download rdp-node.ps1
        run: Invoke-WebRequest 'https://raw.githubusercontent.com/Shahzaib-YT/ngrok-multi-nodes/main/rdp-node.ps1' -OutFile 'rdp.ps1'

      - name: üöÄ Launch RDP Node ${{ matrix.node_id }}
        run: powershell -ExecutionPolicy Bypass -File .\rdp.ps1
        env:
          NGROK_AUTH_TOKEN: ${{ secrets.NGROK_AUTH_TOKEN }}
          NODE_ID: ${{ matrix.node_id }}
